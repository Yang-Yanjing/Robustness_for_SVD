func	2:0	131:0	0	static int	Open
params	2:15	0:0	1	
param	2:17	2:29	2	vlc_va_t *	va
param	2:31	2:45	2	int	i_codec_id
param	2:47	2:66	2	int	i_thread_count
stmnts	0:0	130:23	1	
decl	4:4	4:49	2	vlc_va_sys_t	*sys
op	4:22	0:0	2	=
call	4:24	4:48	3	calloc
arg	4:32	4:33	4	1
water	4:32	0:0	5	1
arg	4:35	4:48	4	sizeof(*sys)
op	4:35	0:0	5	sizeof
water	4:41	0:0	5	(
op	4:42	0:0	5	*
water	4:43	0:0	5	sys
water	4:46	0:0	5	)
if	5:4	6:24	2	(unlikely (sys == NULL ))
cond	5:9	5:29	3	unlikely (sys == NULL )
call	5:9	5:29	4	unlikely
arg	5:18	5:29	5	sys==NULL
water	5:18	0:0	6	sys
op	5:22	0:0	6	==
water	5:25	0:0	6	NULL
stmts	6:7	6:24	3	
return	6:7	6:24	4	VLC_ENOMEM
water	6:14	0:0	5	VLC_ENOMEM
decl	7:4	7:41	2	VAProfile	i_profile
water	7:23	0:0	2	,
decl	7:4	7:41	2	VAProfile	*p_profiles_list
decl	8:4	8:36	2	bool	b_supported_profile
op	8:29	0:0	2	=
water	8:31	0:0	2	false
decl	9:4	9:25	2	int	i_profiles_nb
op	9:22	0:0	2	=
water	9:24	0:0	2	0
decl	10:4	10:23	2	int	i_surface_count
switch	12:4	38:4	2	(i_codec_id)
cond	12:12	12:12	3	i_codec_id
water	12:12	0:0	4	i_codec_id
stmts	13:4	38:4	3	
water	13:4	0:0	4	{
label	14:4	14:31	4	case AV_CODEC_ID_MPEG1VIDEO :
label	15:4	15:31	4	case AV_CODEC_ID_MPEG2VIDEO :
water	16:8	0:0	4	i_profile
op	16:18	0:0	4	=
water	16:20	0:0	4	VAProfileMPEG2Main
water	16:38	0:0	4	;
water	17:8	0:0	4	i_surface_count
op	17:24	0:0	4	=
water	17:26	0:0	4	2
op	17:28	0:0	4	+
water	17:30	0:0	4	2
water	17:31	0:0	4	;
break	18:8	18:13	4	
label	19:4	19:26	4	case AV_CODEC_ID_MPEG4 :
water	20:8	0:0	4	i_profile
op	20:18	0:0	4	=
water	20:20	0:0	4	VAProfileMPEG4AdvancedSimple
water	20:48	0:0	4	;
water	21:8	0:0	4	i_surface_count
op	21:24	0:0	4	=
water	21:26	0:0	4	2
op	21:27	0:0	4	+
water	21:28	0:0	4	1
water	21:29	0:0	4	;
break	22:8	22:13	4	
label	23:4	23:25	4	case AV_CODEC_ID_WMV3 :
water	24:8	0:0	4	i_profile
op	24:18	0:0	4	=
water	24:20	0:0	4	VAProfileVC1Main
water	24:36	0:0	4	;
water	25:8	0:0	4	i_surface_count
op	25:24	0:0	4	=
water	25:26	0:0	4	2
op	25:27	0:0	4	+
water	25:28	0:0	4	1
water	25:29	0:0	4	;
break	26:8	26:13	4	
label	27:4	27:24	4	case AV_CODEC_ID_VC1 :
water	28:8	0:0	4	i_profile
op	28:18	0:0	4	=
water	28:20	0:0	4	VAProfileVC1Advanced
water	28:40	0:0	4	;
water	29:8	0:0	4	i_surface_count
op	29:24	0:0	4	=
water	29:26	0:0	4	2
op	29:27	0:0	4	+
water	29:28	0:0	4	1
water	29:29	0:0	4	;
break	30:8	30:13	4	
label	31:4	31:25	4	case AV_CODEC_ID_H264 :
water	32:8	0:0	4	i_profile
op	32:18	0:0	4	=
water	32:20	0:0	4	VAProfileH264High
water	32:37	0:0	4	;
water	33:8	0:0	4	i_surface_count
op	33:24	0:0	4	=
water	33:26	0:0	4	16
op	33:29	0:0	4	+
water	33:31	0:0	4	i_thread_count
op	33:46	0:0	4	+
water	33:48	0:0	4	2
water	33:49	0:0	4	;
break	34:8	34:13	4	
water	34:14	0:0	4	;
label	35:4	35:11	4	default :
call	36:8	36:18	4	free
arg	36:14	36:18	5	sys
water	36:14	0:0	6	sys
water	36:19	0:0	4	;
return	37:8	37:27	4	VLC_EGENERIC
water	37:15	0:0	5	VLC_EGENERIC
water	38:4	0:0	4	}
water	40:4	0:0	2	sys
op	40:7	0:0	2	->
water	40:9	0:0	2	i_config_id
op	40:22	0:0	2	=
water	40:24	0:0	2	VA_INVALID_ID
water	40:37	0:0	2	;
water	41:4	0:0	2	sys
op	41:7	0:0	2	->
water	41:9	0:0	2	i_context_id
op	41:22	0:0	2	=
water	41:24	0:0	2	VA_INVALID_ID
water	41:37	0:0	2	;
water	42:4	0:0	2	sys
op	42:7	0:0	2	->
water	42:9	0:0	2	image
op	42:14	0:0	2	.
water	42:15	0:0	2	image_id
op	42:24	0:0	2	=
water	42:26	0:0	2	VA_INVALID_ID
water	42:39	0:0	2	;
water	45:4	0:0	2	sys
op	45:7	0:0	2	->
water	45:9	0:0	2	p_display_x11
op	45:23	0:0	2	=
call	45:25	45:42	2	XOpenDisplay
arg	45:38	45:42	3	NULL
water	45:38	0:0	4	NULL
water	45:43	0:0	2	;
if	46:4	50:4	2	(! sys -> p_display_x11)
cond	46:8	46:14	3	! sys -> p_display_x11
op	46:8	0:0	4	!
water	46:9	0:0	4	sys
op	46:12	0:0	4	->
water	46:14	0:0	4	p_display_x11
stmts	47:4	50:4	3	
water	47:4	0:0	4	{
call	48:8	48:53	4	msg_Err
arg	48:17	48:19	5	va
water	48:17	0:0	6	va
arg	48:21	48:53	5	"Could not connect to X server"
water	48:21	0:0	6	"Could not connect to X server"
water	48:54	0:0	4	;
goto	49:8	49:18	4	error
water	49:13	0:0	5	error
water	50:4	0:0	4	}
water	51:4	0:0	2	sys
op	51:7	0:0	2	->
water	51:9	0:0	2	p_display
op	51:19	0:0	2	=
call	51:21	51:54	2	vaGetDisplay
arg	51:35	51:54	3	sys->p_display_x11
water	51:35	0:0	4	sys
op	51:38	0:0	4	->
water	51:40	0:0	4	p_display_x11
water	51:55	0:0	2	;
water	54:4	0:0	2	sys
op	54:7	0:0	2	->
water	54:9	0:0	2	drm_fd
op	54:16	0:0	2	=
call	54:18	54:51	2	vlc_open
arg	54:27	54:43	3	"/dev/dri/card0"
water	54:27	0:0	4	"/dev/dri/card0"
arg	54:45	54:51	3	O_RDWR
water	54:45	0:0	4	O_RDWR
water	54:52	0:0	2	;
if	55:4	59:4	2	(sys -> drm_fd == - 1)
cond	55:8	55:24	3	sys -> drm_fd == - 1
water	55:8	0:0	4	sys
op	55:11	0:0	4	->
water	55:13	0:0	4	drm_fd
op	55:20	0:0	4	==
op	55:23	0:0	4	-
water	55:24	0:0	4	1
stmts	56:4	59:4	3	
water	56:4	0:0	4	{
call	57:8	57:61	4	msg_Err
arg	57:17	57:19	5	va
water	57:17	0:0	6	va
arg	57:21	57:61	5	"Could not access rendering device: %m"
water	57:21	0:0	6	"Could not access rendering device: %m"
water	57:62	0:0	4	;
goto	58:8	58:18	4	error
water	58:13	0:0	5	error
water	59:4	0:0	4	}
water	60:4	0:0	2	sys
op	60:7	0:0	2	->
water	60:9	0:0	2	p_display
op	60:19	0:0	2	=
call	60:21	60:50	2	vaGetDisplayDRM
arg	60:38	60:50	3	sys->drm_fd
water	60:38	0:0	4	sys
op	60:41	0:0	4	->
water	60:43	0:0	4	drm_fd
water	60:51	0:0	2	;
if	62:4	66:4	2	(! sys -> p_display)
cond	62:8	62:14	3	! sys -> p_display
op	62:8	0:0	4	!
water	62:9	0:0	4	sys
op	62:12	0:0	4	->
water	62:14	0:0	4	p_display
stmts	63:4	66:4	3	
water	63:4	0:0	4	{
call	64:8	64:52	4	msg_Err
arg	64:17	64:19	5	va
water	64:17	0:0	6	va
arg	64:21	64:52	5	"Could not get a VAAPI device"
water	64:21	0:0	6	"Could not get a VAAPI device"
water	64:53	0:0	4	;
goto	65:8	65:18	4	error
water	65:13	0:0	5	error
water	66:4	0:0	4	}
decl	67:4	67:20	2	int	major
water	67:13	0:0	2	,
decl	67:4	67:20	2	int	minor
if	68:4	72:4	2	(vaInitialize (sys -> p_display ,& major ,& minor ))
cond	68:8	68:53	3	vaInitialize (sys -> p_display ,& major ,& minor )
call	68:8	68:53	4	vaInitialize
arg	68:22	68:36	5	sys->p_display
water	68:22	0:0	6	sys
op	68:25	0:0	6	->
water	68:27	0:0	6	p_display
arg	68:38	68:44	5	&major
op	68:38	0:0	6	&
water	68:39	0:0	6	major
arg	68:46	68:53	5	&minor
op	68:46	0:0	6	&
water	68:47	0:0	6	minor
stmts	69:4	72:4	3	
water	69:4	0:0	4	{
call	70:8	70:61	4	msg_Err
arg	70:17	70:19	5	va
water	70:17	0:0	6	va
arg	70:21	70:61	5	"Failed to initialize the VAAPI device"
water	70:21	0:0	6	"Failed to initialize the VAAPI device"
water	70:62	0:0	4	;
goto	71:8	71:18	4	error
water	71:13	0:0	5	error
water	72:4	0:0	4	}
water	74:4	0:0	2	i_profiles_nb
op	74:18	0:0	2	=
call	74:20	74:53	2	vaMaxNumProfiles
arg	74:38	74:53	3	sys->p_display
water	74:38	0:0	4	sys
op	74:41	0:0	4	->
water	74:43	0:0	4	p_display
water	74:54	0:0	2	;
water	75:4	0:0	2	p_profiles_list
op	75:20	0:0	2	=
call	75:22	75:65	2	calloc
arg	75:30	75:43	3	i_profiles_nb
water	75:30	0:0	4	i_profiles_nb
arg	75:45	75:65	3	sizeof(VAProfile)
op	75:45	0:0	4	sizeof
water	75:51	0:0	4	(
water	75:53	0:0	4	VAProfile
water	75:63	0:0	4	)
water	75:66	0:0	2	;
if	76:4	77:18	2	(! p_profiles_list)
cond	76:8	76:9	3	! p_profiles_list
op	76:8	0:0	4	!
water	76:9	0:0	4	p_profiles_list
stmts	77:8	77:18	3	
goto	77:8	77:18	4	error
water	77:13	0:0	5	error
decl	78:4	78:96	2	VAStatus	i_status
op	78:22	0:0	2	=
call	78:24	78:95	3	vaQueryConfigProfiles
arg	78:47	78:61	4	sys->p_display
water	78:47	0:0	5	sys
op	78:50	0:0	5	->
water	78:52	0:0	5	p_display
arg	78:63	78:78	4	p_profiles_list
water	78:63	0:0	5	p_profiles_list
arg	78:80	78:95	4	&i_profiles_nb
op	78:80	0:0	5	&
water	78:81	0:0	5	i_profiles_nb
if	79:4	89:4	2	(i_status == VA_STATUS_SUCCESS)
cond	79:9	79:21	3	i_status == VA_STATUS_SUCCESS
water	79:9	0:0	4	i_status
op	79:18	0:0	4	==
water	79:21	0:0	4	VA_STATUS_SUCCESS
stmts	80:4	89:4	3	
water	80:4	0:0	4	{
for	81:8	88:8	4	( int i = 0 ;i < i_profiles_nb;i ++)
forinit	0:0	81:22	5	 int i = 0 ;
decl	81:13	81:22	6	int	i
op	81:19	0:0	6	=
water	81:21	0:0	6	0
cond	81:24	81:28	5	i < i_profiles_nb
water	81:24	0:0	6	i
op	81:26	0:0	6	<
water	81:28	0:0	6	i_profiles_nb
forexpr	81:43	81:44	5	i ++
water	81:43	0:0	6	i
op	81:44	0:0	6	++
stmts	82:8	88:8	5	
water	82:8	0:0	6	{
if	83:12	87:12	6	(p_profiles_list [ i ] == i_profile)
cond	83:17	83:39	7	p_profiles_list [ i ] == i_profile
water	83:17	0:0	8	p_profiles_list
op	83:32	0:0	8	[
water	83:33	0:0	8	i
op	83:34	0:0	8	]
op	83:36	0:0	8	==
water	83:39	0:0	8	i_profile
stmts	84:12	87:12	7	
water	84:12	0:0	8	{
water	85:16	0:0	8	b_supported_profile
op	85:36	0:0	8	=
water	85:38	0:0	8	true
water	85:42	0:0	8	;
break	86:16	86:21	8	
water	87:12	0:0	8	}
water	88:8	0:0	6	}
water	89:4	0:0	4	}
call	90:4	90:26	2	free
arg	90:10	90:26	3	p_profiles_list
water	90:10	0:0	4	p_profiles_list
water	90:27	0:0	2	;
if	91:4	95:4	2	(! b_supported_profile)
cond	91:9	91:10	3	! b_supported_profile
op	91:9	0:0	4	!
water	91:10	0:0	4	b_supported_profile
stmts	92:4	95:4	3	
water	92:4	0:0	4	{
call	93:8	93:71	4	msg_Dbg
arg	93:17	93:19	5	va
water	93:17	0:0	6	va
arg	93:21	93:71	5	"Codec and profile not supported by the hardware"
water	93:21	0:0	6	"Codec and profile not supported by the hardware"
water	93:72	0:0	4	;
goto	94:8	94:18	4	error
water	94:13	0:0	5	error
water	95:4	0:0	4	}
decl	97:4	97:25	2	VAConfigAttrib	attrib
call	98:4	98:39	2	memset
arg	98:12	98:19	3	&attrib
op	98:12	0:0	4	&
water	98:13	0:0	4	attrib
arg	98:21	98:22	3	0
water	98:21	0:0	4	0
arg	98:24	98:39	3	sizeof(attrib)
op	98:24	0:0	4	sizeof
water	98:30	0:0	4	(
water	98:31	0:0	4	attrib
water	98:37	0:0	4	)
water	98:40	0:0	2	;
water	99:4	0:0	2	attrib
op	99:10	0:0	2	.
water	99:11	0:0	2	type
op	99:16	0:0	2	=
water	99:18	0:0	2	VAConfigAttribRTFormat
water	99:40	0:0	2	;
if	100:4	102:18	2	(vaGetConfigAttributes (sys -> p_display ,i_profile ,VAEntrypointVLD ,& attrib ,1 ))
cond	100:8	101:70	3	vaGetConfigAttributes (sys -> p_display ,i_profile ,VAEntrypointVLD ,& attrib ,1 )
call	100:8	101:70	4	vaGetConfigAttributes
arg	100:31	100:45	5	sys->p_display
water	100:31	0:0	6	sys
op	100:34	0:0	6	->
water	100:36	0:0	6	p_display
arg	101:31	101:40	5	i_profile
water	101:31	0:0	6	i_profile
arg	101:42	101:57	5	VAEntrypointVLD
water	101:42	0:0	6	VAEntrypointVLD
arg	101:59	101:66	5	&attrib
op	101:59	0:0	6	&
water	101:60	0:0	6	attrib
arg	101:68	101:70	5	1
water	101:68	0:0	6	1
stmts	102:8	102:18	3	
goto	102:8	102:18	4	error
water	102:13	0:0	5	error
if	104:4	105:18	2	(( attrib . value & VA_RT_FORMAT_YUV420 ) == 0)
cond	104:8	104:48	3	( attrib . value & VA_RT_FORMAT_YUV420 ) == 0
water	104:8	0:0	4	(
water	104:9	0:0	4	attrib
op	104:15	0:0	4	.
water	104:16	0:0	4	value
op	104:22	0:0	4	&
water	104:24	0:0	4	VA_RT_FORMAT_YUV420
water	104:43	0:0	4	)
op	104:45	0:0	4	==
water	104:48	0:0	4	0
stmts	105:8	105:18	3	
goto	105:8	105:18	4	error
water	105:13	0:0	5	error
if	106:4	111:4	2	(vaCreateConfig (sys -> p_display ,i_profile ,VAEntrypointVLD ,& attrib ,1 ,& sys -> i_config_id ))
cond	106:8	107:82	3	vaCreateConfig (sys -> p_display ,i_profile ,VAEntrypointVLD ,& attrib ,1 ,& sys -> i_config_id )
call	106:8	107:82	4	vaCreateConfig
arg	106:24	106:38	5	sys->p_display
water	106:24	0:0	6	sys
op	106:27	0:0	6	->
water	106:29	0:0	6	p_display
arg	107:24	107:33	5	i_profile
water	107:24	0:0	6	i_profile
arg	107:35	107:50	5	VAEntrypointVLD
water	107:35	0:0	6	VAEntrypointVLD
arg	107:52	107:59	5	&attrib
op	107:52	0:0	6	&
water	107:53	0:0	6	attrib
arg	107:61	107:62	5	1
water	107:61	0:0	6	1
arg	107:64	107:82	5	&sys->i_config_id
op	107:64	0:0	6	&
water	107:65	0:0	6	sys
op	107:68	0:0	6	->
water	107:70	0:0	6	i_config_id
stmts	108:4	111:4	3	
water	108:4	0:0	4	{
water	109:8	0:0	4	sys
op	109:11	0:0	4	->
water	109:13	0:0	4	i_config_id
op	109:25	0:0	4	=
water	109:27	0:0	4	VA_INVALID_ID
water	109:40	0:0	4	;
goto	110:8	110:18	4	error
water	110:13	0:0	5	error
water	111:4	0:0	4	}
water	112:4	0:0	2	sys
op	112:7	0:0	2	->
water	112:9	0:0	2	i_surface_count
op	112:25	0:0	2	=
water	112:27	0:0	2	i_surface_count
water	112:42	0:0	2	;
water	113:4	0:0	2	sys
op	113:7	0:0	2	->
water	113:9	0:0	2	b_supports_derive
op	113:27	0:0	2	=
water	113:29	0:0	2	false
water	113:34	0:0	2	;
call	114:4	114:29	2	vlc_mutex_init
arg	114:19	114:29	3	&sys->lock
op	114:19	0:0	4	&
water	114:20	0:0	4	sys
op	114:23	0:0	4	->
water	114:25	0:0	4	lock
water	114:30	0:0	2	;
water	115:4	0:0	2	va
op	115:6	0:0	2	->
water	115:8	0:0	2	sys
op	115:12	0:0	2	=
water	115:14	0:0	2	sys
water	115:17	0:0	2	;
water	116:4	0:0	2	va
op	116:6	0:0	2	->
water	116:8	0:0	2	description
op	116:20	0:0	2	=
call	116:22	116:58	2	vaQueryVendorString
arg	116:43	116:58	3	sys->p_display
water	116:43	0:0	4	sys
op	116:46	0:0	4	->
water	116:48	0:0	4	p_display
water	116:59	0:0	2	;
return	117:4	117:22	2	VLC_SUCCESS
water	117:11	0:0	3	VLC_SUCCESS
label	118:0	118:5	2	error :
if	119:4	120:37	2	(sys -> p_display != NULL)
cond	119:8	119:26	3	sys -> p_display != NULL
water	119:8	0:0	4	sys
op	119:11	0:0	4	->
water	119:13	0:0	4	p_display
op	119:23	0:0	4	!=
water	119:26	0:0	4	NULL
stmts	120:8	120:37	3	
call	120:8	120:36	4	vaTerminate
arg	120:21	120:36	5	sys->p_display
water	120:21	0:0	6	sys
op	120:24	0:0	6	->
water	120:26	0:0	6	p_display
water	120:37	0:0	4	;
if	122:4	123:43	2	(sys -> p_display_x11 != NULL)
cond	122:8	122:30	3	sys -> p_display_x11 != NULL
water	122:8	0:0	4	sys
op	122:11	0:0	4	->
water	122:13	0:0	4	p_display_x11
op	122:27	0:0	4	!=
water	122:30	0:0	4	NULL
stmts	123:8	123:43	3	
call	123:8	123:42	4	XCloseDisplay
arg	123:23	123:42	5	sys->p_display_x11
water	123:23	0:0	6	sys
op	123:26	0:0	6	->
water	123:28	0:0	6	p_display_x11
water	123:43	0:0	4	;
if	126:4	127:28	2	(sys -> drm_fd != - 1)
cond	126:8	126:24	3	sys -> drm_fd != - 1
water	126:8	0:0	4	sys
op	126:11	0:0	4	->
water	126:13	0:0	4	drm_fd
op	126:20	0:0	4	!=
op	126:23	0:0	4	-
water	126:24	0:0	4	1
stmts	127:8	127:28	3	
call	127:8	127:27	4	close
arg	127:15	127:27	5	sys->drm_fd
water	127:15	0:0	6	sys
op	127:18	0:0	6	->
water	127:20	0:0	6	drm_fd
water	127:28	0:0	4	;
call	129:4	129:14	2	free
arg	129:10	129:14	3	sys
water	129:10	0:0	4	sys
water	129:15	0:0	2	;
return	130:4	130:23	2	VLC_EGENERIC
water	130:11	0:0	3	VLC_EGENERIC
